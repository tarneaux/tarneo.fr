---
import Base from "../layouts/Base.astro";
import List from "../components/List.astro";
import ListItem from "../components/ListItem.astro";
import Icon from "../components/Icon.astro";

var posts = [];
var noposts = false;

// Use Astro.glob() to fetch all posts, and then sort them by date.
try {
    posts = (await Astro.glob('./blog/*')).sort(
        (a, b) => new Date(b.frontmatter.pubDate).valueOf() - new Date(a.frontmatter.date).valueOf()
    );
} catch (error) {
    noposts = true;
}
---

<Base>
    <style>
        ul {
            list-style-type: none;
            padding: unset;
        }
        ul li {
            display: flex;
        }
        ul li time {
            flex: 0 0 130px;
            font-style: italic;
            color: #888;
        }
        ul li a:visited {
            color: #8e32dc;
        }
    </style>
    <ul>
        <main>
            <h1>Most recent blog posts</h1>
            <p><b>BAGUETTE WARNING:</b> some of these are in french.</p>
            {!noposts && <List title="Posts:">
                {posts.sort((a, b) => new Date(b.frontmatter.pubDate).valueOf() - new Date(a.frontmatter.pubDate).valueOf()).map((post) => (
                    <ListItem label={new Date(post.frontmatter.pubDate).toLocaleDateString('en-us', {
                                year: 'numeric',
                                month: 'long',
                                day: 'numeric',
                            })}>
                        <a href={post.url}>{post.frontmatter.title}</a>
                    </ListItem>
                ))}
            </List>}
            {noposts && <p>No posts found.</p>}
            <br>
            <a class="rss-link" href="/rss.xml"><Icon icon="rss" />RSS</a>
        </main>
    </ul>
    <style>
        .rss-link {
            text-decoration: none;
            border-bottom: 1px solid var(--color13);
        }
    </style>
</Base>
